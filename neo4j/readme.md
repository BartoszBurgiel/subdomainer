# Neo4j integration 
The JSON result which is generated by each scan can be loaded into Neo4j for some cool visualization and analysis of the data. 

Use the provided `docker-compose.yml` file and place the scan result you want to load to neo4j into the same directory as the `docker-compose.yml` and run it with `docker compose up`. Then, go to `localhost:7474` to access the database. 

Sadly, by default, subdomains' labels in neo4j is the html title, which is not always set. To have the actual subdomain as the display text of every subdomain note, it has to be set manually. It is explained here how to do it: 

https://stackoverflow.com/questions/56051048/how-to-set-text-on-the-node-in-neo4j

## Cypher queries 
To load the data, use the following query 
```cypher

CALL apoc.periodic.iterate(
  'CALL apoc.load.json("data.json") YIELD value RETURN value',
  '

  // create all subdomain nodes and their occurence
  MERGE (s:Subdomain {domain:value.domain, hash:value.hash, size: value.size, title: value.title, statuscode: value.statuscode, server: value.server})
  MERGE (occ:Occurence {tag: value.occurence})
  merge (s)-[:foundIn]->(occ)

  // create the ip addresses and whois info
  with s, value
  unwind value.ip as ipaddr
  merge (ip:IPAddr {ip:ipaddr.ip})
  merge (whois:Whois {inetnum:ipaddr.whois.inetnum, netname: ipaddr.whois.netname, country: ipaddr.whois.country, org: ipaddr.whois.country})
  merge (s)-[:resolvesTo]->(ip)
  merge (ip)-[:isIn]->(whois)

  ',
  {batchSize: 100, parallel: false}
)
```

Then, the sky is your limit. Here are some example queries: 
- `match (n:Subdomain) where n.server <> "" and n.server <> "no response" return n`
	- return only nodes which have a valid server header set
- `match (n:Subdomain) where n.statuscode > 0 return n`
	- return nodes which responded with a valid http request
- `MATCH p=()-[r:foundIn]->(o) where o.tag = "Number fuzzing" RETURN p`
	- get all nodes which were found through number fuzzing
